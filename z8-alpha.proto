syntax = "proto3";

option java_package = "z8.proto.alpha";
option java_outer_classname = "Z8ProtoAlpha";
option java_multiple_files = true;

message ServerMessage {
    string secret = 1;
    string target = 2;
    oneof body {
        WelcomeMessage welcome_message = 3;
        ShutdownMessage shutdown_message = 4;
        PingMessage ping_message = 5;

        TimeResponse time_response = 6;

        PlayMelody play_melody = 7;
        StopMelody stop_melody = 8;

        StoreInDisplayBuffer store_in_display_buffer = 9;
        ClearDisplayBuffer clear_display_buffer = 10;
        PrintOnDisplay print_on_display = 11;
        ClearDisplay clear_display = 12;

        TokenWriteEvent token_write_event = 13;

    }
}

message ClientMessage {
    string secret = 1;
    string source = 2;
    oneof body {
        WelcomeMessage welcome_message = 3;
        ShutdownMessage shutdown_message = 4;
        PingMessage ping_message = 5;

        TimeRequest time_request = 6;

        MelodyPlayed melody_played = 7;
        MelodyStopped melody_stopped = 8;

        StoredInDisplayBuffer stored_in_display_buffer = 9;
        DisplayBufferCleared display_buffer_cleared = 10;
        PrintedOnDisply printed_on_display = 11;
        DisplayCleared display_cleared = 12;

        TokenReadEvent token_read_event = 13;
        TokenWrittenEvent token_written_event = 14;
        TokenLoseEvent token_lose_event = 15;
        DesFireAuthentication des_fire_authentication = 16;
        SecretChange secret_change = 17;
    }
}

//MAIN

message WelcomeMessage {

}

message ShutdownMessage {

}

message PingMessage {

}

//TIME

message TimeRequest {

}

message TimeResponse {
    fixed64 timestamp = 1;
}

//BEEP

message PlayMelody {
    repeated int32 notes = 1;
}

message MelodyPlayed {

}

message StopMelody {

}

message MelodyStopped {

}

//DISPLAY

message StoreInDisplayBuffer {
    fixed32 line = 1;
    enum Operation {
        APPEND = 0;
        OVERWRITE = 1;
    }
}

message StoredInDisplayBuffer {

}

message ClearDisplayBuffer {

}

message DisplayBufferCleared {

}

message PrintOnDisplay {
    enum Animation {
        NONE = 0;
        SINGLE_LINE = 1;
        ALL_LINES = 2;
    }
    int32 line = 3;
}

message PrintedOnDisply {

}

message ClearDisplay {

}

message DisplayCleared {

}

//TOKEN

message TokenReadEvent {
    string token = 1;
}

message TokenWriteEvent {
    int64 id = 1;
    string token = 2;
    int32 block = 3;
    bytes data = 4;
}

message TokenWrittenEvent {
    int64 id = 1;
    string token = 2;
}


message TokenLoseEvent {
    string token = 1;
}

//SPECIAL

message DesFireAuthentication {
    string token = 1;
    int32 stage = 2;
    bytes data = 3 [(nanopb).max_size = 24, (nanopb).fixed_length = true];;
}

message SecretChange {
    string new_secret = 1;
}
